# network interface settings; autogenerated
# Please do NOT modify this file directly, unless you know what
# you're doing.
#
# If you want to manage parts of the network configuration manually,
# please utilize the 'source' or 'source-directory' directives to do
# so.
# PVE will preserve these directives, but will NOT read its network
# configuration from sourced files, so do not attempt to move any of
# the PVE managed interfaces into external files!
auto lo
iface lo inet loopback

iface eno1 inet manual
iface eno2 inet manual
iface eno3 inet manual
iface eno4 inet manual

iface enp6s0 inet manual # 10G uplink to CRS326
iface enp7s0f0 inet manual # 10G vlan30 access
iface enp7s0f1 inet manual # 10G vlan30 access

auto vmbr0
iface vmbr0 inet static
        address 10.100.10.18/28
        gateway 10.100.10.17
        bridge-ports enp6s0 enp7s0f0 enp7s0f1
        bridge-stp off
        bridge-fd 0
        bridge-vlan-aware yes

        post-up ip link set dev vmbr0 type bridge vlan_filtering 1
        
        # this here clears default VLAN settings on all ports
        post-up bridge vlan del dev enp6s0 vid 1
        post-up bridge vlan del dev enp7s0f0 vid 1
        post-up bridge vlan del dev enp7s0f1 vid 1
        post-up bridge vlan del dev vmbr0 vid 1 self        


        # config of uplink port
        post-up bridge vlan add dev enp6s0 vid 20 pvid untagged
        post-up bridge vlan add dev enp6s0 vid 30 tagged
        post-up bridge vlan add dev enp6s0 vid 40 tagged
        
        # config of VLAN 30 access on dedicated interfaces
        post-up bridge vlan add dev enp7s0f0 vid 30 pvid untagged
        post-up bridge vlan add dev enp7s0f1 vid 30 pvid untagged
        
        # super important cause without this, its not possible to access proxmox VE GUI
        post-up bridge vlan add dev vmbr0 vid 20 pvid untagged self

source /etc/network/interfaces.d/*
